---
######################################
# Cautious agent
######################################
$schema: https://mmarini.org/wheelly/agent-state-machine-schema-0.4
class: org.mmarini.wheelly.engines.StateMachineAgent
flow:
  entry: mapping
  states:
    mapping:
      $id: https://mmarini.org/wheelly/state-mapping-schema-0.1
      class: org.mmarini.wheelly.engines.MappingState
      timeout: 600000
      transitions:
        blocked:
          to: clearMap
        frontBlocked:
          to: avoid
        rearBlocked:
          to: avoid
        completed:
          to: findLabel
        found:
          to: findLabel
    findLabel:
      $id: https://mmarini.org/wheelly/state-search-label-schema-0.1
      class: org.mmarini.wheelly.engines.SearchLabelState
      maxSearchTime: 3000
      minGoals: 2
      distance: 0.8
      transitions:
        completed:
          to: labelStuck
        notFound:
          to: findUnknown
        timeout:
          to: mapping
        blocked:
          to: clearMap
        frontBlocked:
          to: avoid
        rearBlocked:
          to: avoid
    findUnknown:
      $id: https://mmarini.org/wheelly/state-search-unknown-schema-0.1
      class: org.mmarini.wheelly.engines.SearchUnknownState
      maxSearchTime: 3000
      minGoals: 2
      transitions:
        completed:
          to: mapping
        timeout:
          to: mapping
        blocked:
          to: clearMap
        frontBlocked:
          to: avoid
        rearBlocked:
          to: avoid
        notFound:
          to: findRefresh
    findRefresh:
      $id: https://mmarini.org/wheelly/state-search-refresh-schema-0.1
      class: org.mmarini.wheelly.engines.SearchRefreshState
      maxSearchTime: 3000
      minGoals: 2
      transitions:
        completed:
          to: mapping
        timeout:
          to: mapping
        blocked:
          to: clearMap
        frontBlocked:
          to: avoid
        rearBlocked:
          to: avoid
        notFound:
          to: mapping
    labelStuck:
      $id: https://mmarini.org/wheelly/state-label-stuck-schema-0.1
      class: org.mmarini.wheelly.engines.LabelStuckState
      distance: 0.5
      transitions:
        blocked:
          to: clearMap
        frontBlocked:
          to: avoid
        rearBlocked:
          to: avoid
        notFound:
          to: mapping
    clearMap:
      $id: https://mmarini.org/wheelly/state-clear-map-schema-0.1
      class: org.mmarini.wheelly.engines.ClearMapState
      transitions:
        ".*":
          to: avoid
    avoid:
      $id: https://mmarini.org/wheelly/state-avoid-schema-0.1
      class: org.mmarini.wheelly.engines.AvoidingState
      safeDistance: 0.2
      speed: 20
      transitions:
        completed:
          to: mapping
        blocked:
          to: clearMap
