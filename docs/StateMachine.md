
After installed the application run the command:

```bash
java -classpath lib/wheelly-0.5.0.jar org.mmarini.wheelly.apps.RobotExecutor
```

the options are

```bash
> java -classpath lib/wheelly-0.5.0.jar org.mmarini.wheelly.apps.RobotExecutor -h
usage: org.mmarini.wheelly.apps.RobotExecutor
       [-h] [-v] [-r ROBOT] [-a AGENT] [-s] [-t TIME]

Run a session of interaction between robot and environment.

named arguments:
  -h, --help             show this help message and exit
  -v, --version          show current version
  -r ROBOT, --robot ROBOT
                         specify robot  yaml  configuration  file (default:
                         robot.yml)
  -a AGENT, --agent AGENT
                         specify agent  yaml  configuration  file (default:
                         agent.yml)
  -s, --silent           specify  silent  closing   (no   window  messages)
                         (default: false)
  -t TIME, --time TIME   specify number  of  seconds  of  session  duration
                         (default: 43200)
```

### State machine agent

The robot executor used a state machine base agent.
The configuration of state machine agent defines the the flow of process.
It defines the states of the flow, the transitions and the entry state.

Transitions are defined by specifying the starting state, the arrival state and the trigger condition
(a regex on the signal generated by the state).
The onTransition command for each transition can be specified as well.

An example of state machine flow is:

```yaml

flow:
  entry: start
  states:
    start:
      class: org.mmarini.wheelly.engines.HaltState
      timeout: 2000
    exploring:
      class: org.mmarini.wheelly.engines.ExploringState
      stopDistance: 0.5
      turnDirectionRange: 30
    avoiding:
      class: org.mmarini.wheelly.engines.AvoidingState
  transitions:
    - from: start
      to: exploring
      trigger: timeout
    - from: exploring
      to: avoiding
      trigger: blocked
    - from: avoiding
      to: exploring
      trigger: completed

```

### State specification

Each state is defined by the java implementation class, the onInit, onEntry, onExit commands
and specific parameters value for the state node behaviors.
Each state has the variables:

- `<status-id>.entryTime` the entry time

### Halt state `org.mmarini.wheelly.engines.HaltState`

The halt state stops the robot and may activates the automatic movement of scanner.

Signals are:

- `timeout` signal is generated whenever the timeout interval has elapsed from state entry instant. 
- `frontBlocked` signal is generated when robot has front obstacle contact.
- `rearBlocked` signal is generated when robot has rear obstacle contact.
- `blocked` signal is generated when robot has both front and rear obstacle contacts.

Parameter are:

- `timeout` timeout interval (ms)
- `scanInterval` interval between scanner sensor movement (ms)
- `minSensorDir` minimum scanner direction (DEG)
- `maxSensorDir` maximum scanner direction (DEG)
- `sensorDirNumber` number of directions to scan

Variables are:

- `<status-id>.scanTime` the last scanner time
- `<status-id>.scanIndex` the next scan index [0 ... (sensorDirNumber - 1) * 2]

### Avoiding state `org.mmarini.wheelly.engines.AvoidingState`

The avoiding state moves the robot away from contact obstacle.

- `timeout` signal is generated whenever the timeout interval has elapsed from state entry instant.
- `completed` signal is generated whenever the robot has no more obstacle contacts and at a safe distance from obstacles.
- `blocked` signal is generated when robot cannot move anywhere.

Parameter are:

- `timeout` timeout interval (ms)
- `safeDistance`: the safe distance from obstacle (m)

Variables are:

- `<state-id>.escapeDirection` the escape direction (DEG)
- `<state-id>.freePoint` the safety point to move towards

### Exploring state `org.mmarini.wheelly.engines.ExploringState`

The exploring state moves the robot round the environment to explore the unknwon zones.

The signals are:
- `timeout` signal is generated whenever the timeout interval has elapsed from state entry instant.
- `frontBlocked` signal is generated when robot has front obstacle contact.
- `rearBlocked` signal is generated when robot has rear obstacle contact.
- `blocked` signal is generated when robot has both front and rear obstacle contacts.

Parameter are:

- `timeout` timeout interval (ms)
- `stopDistance` the stop distance distance from obstacles to stop the robot (m)
- `turnDirectionRange`: turn direction range (DEG) to turn the robot, beyond which the robot move ahead

### Select exploring point state `org.mmarini.wheelly.engines.ExploringPointState`

The state selects the point of the unknown area to move towards.
It searches for the unknown sector of the radar map at a distance greater than the minimum distance that can be reached directly from the robot's position.
If it does not exist, it searches for the furthest reachable point.

The signals are:
- `timeout` signal is generated whenever the timeout interval has elapsed from state entry instant.
- `completed` signal is generated if the point exists.
- `notFound` signal is generated if no points are founded.

Parameter are:

- `timeout` timeout interval (ms)
- `distance` the minimum distance of the point from the robot (m)

Variable:

- `target`:  the point of the unknown area to move towards

### Command specification

Each command is specified by a sequence of operators.

Base operator are:

- `add` performs the sum on last 2 operand in the stack `op(n-1) + op(n)`
- `sub` performs the difference on last 2 operand in the stack `op(n-1) - op2(n)`
- `mul` performs the product on last 2 operand in the stack `op(n-1) * op(n)`
- `div` performs the division on last 2 operand in the stack `op(n-1) / op(n)`
- `neg` performs the negation on last operand in the stack `-op(n)`
- `get` performs the read of value in the key, value map `map.get(key=op(n)`
- `put` performs the write of value in the key, value map `map.put(key=op(n-1), value=op(n))`
- `swap` performs the swap position in the stack of last two operands
- `time` push in the stack the time value (ms)

any other string defines operator that pushes in the stack the string value

Example:

Store the value `3=(1+2)` in the key, value map with key `aKey` 
```yaml
onInit:
  - aKey
  - 1
  - 2
  - add
  - put
```

---
_Release 0.10.1_